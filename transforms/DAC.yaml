# Transform for DAC registers based on DAC0 on G350x
transforms:
  - !DeleteUselessEnums

  - !DeleteFieldsets
    from: .*
    useless: true

  - !DeleteEnumsWithVariants
    variants:
      0: CLR
      1: SET

  - !DeleteEnumsWithVariants
    variants:
      0: CLEARED
      1: SET

  - !DeleteEnumsWithVariants
    variants:
      0: NOP
      1: ASSERT

  - !DeleteEnumsWithVariants
    variants:
      0: NORES
      1: RESET

  - !DeleteEnumsWithVariants
    variants:
      0: NOP
      1: CLR

  - !DeleteEnumsWithVariants
    variants:
      0: DISABLE
      1: EVAL

  # Merge DAC0 -> DAC
  - !MergeBlocks
    from: DAC0
    main: DAC0
    to: DAC

  # Remove DAC0_ prefixes
  - !RenameRegisters
    block: .*
    from: DAC0_(.+)
    to: $1

  - !RenameFields
    fieldset: .*
    from: DAC0_(.+)
    to: $1

  - !Rename
    type: All
    from: DAC0_(.+)
    to: $1

  ## Interrupts - DAC has INT_EVENT[0..1]
  # Merge INT_EVENT blocks
  - !MergeBlocks
    from: INT_EVENT
    main: INT_EVENT
    to: INT_EVENT

  - !RenameRegisters
    block: .*
    from: INT_EVENT_(.+)
    to: $1

  - !RenameFields
    fieldset: .*
    from: INT_EVENT_(.+)
    to: $1

  - !Rename
    type: All
    from: INT_EVENT_(.+)
    to: $1

  # Merge interrupt fieldsets
  - !MergeFieldsets
    from: (IMASK|ISET|MIS|RIS|ICLR)
    to: INT
    check: NoCheck

  ## Add missing keys
  - !AddFields
    fieldset: RSTCTL
    fields:
    - name: KEY
      description: Unlock key B1h = KEY to allow write access to this register
      bit_offset: 24
      bit_size: 8
      enum: RESET_KEY

  - !AddFields
    fieldset: PWREN
    fields:
    - name: KEY
      description: KEY to allow Power State Change 26h = KEY to allow write access to this register
      bit_offset: 24
      bit_size: 8
      enum: PWREN_KEY

  - !Add
    ir:
      enum/RESET_KEY:
        bit_size: 8
        variants:
          - name: KEY
            value: 177
      enum/PWREN_KEY:
        bit_size: 8
        variants:
          - name: KEY
            value: 38

  ## EVT_MODE
  - !MergeEnums
    from: (INT|EVT)(\d+)_CFG
    to: EVT_CFG

  ## Cleanup
  - !Sort
